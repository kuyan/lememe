!function(a){"use strict";var b=function(b,c){this.options=a.extend({},a.fn.combobox.defaults,c);this.$source=a(b);this.$container=this.setup();this.$element=this.$container.find('input[type=text]');this.$target=this.$container.find('input[type=hidden]');this.$button=this.$container.find('.dropdown-toggle');this.$menu=a(this.options.menu).appendTo('body');this.matcher=this.options.matcher||this.matcher;this.sorter=this.options.sorter||this.sorter;this.highlighter=this.options.highlighter||this.highlighter;this.shown=false;this.selected=false;this.refresh();this.transferAttributes();this.listen();};b.prototype=a.extend({},a.fn.typeahead.Constructor.prototype,{constructor:b,setup:function(){var b=a(this.options.template);this.$source.before(b);this.$source.hide();return b;},parse:function(){var b=this,c={},d=[],e=false;this.$source.find('option').each(function(){var f=a(this);if(f.val()===''){b.options.placeholder=f.text();return;}c[f.text()]=f.val();d.push(f.text());if(f.attr('selected'))e=f.text();});this.map=c;if(e){this.$element.val(e);this.$container.addClass('combobox-selected');this.selected=true;}return d;},transferAttributes:function(){this.options.placeholder=this.$source.attr('data-placeholder')||this.options.placeholder;this.$element.attr('placeholder',this.options.placeholder);this.$target.prop('name',this.$source.prop('name'));this.$target.val(this.$source.val());this.$source.removeAttr('name');this.$element.attr('required',this.$source.attr('required'));this.$element.attr('rel',this.$source.attr('rel'));this.$element.attr('title',this.$source.attr('title'));this.$element.attr('class',this.$source.attr('class'));this.$element.attr('tabindex',this.$source.attr('tabindex'));this.$source.removeAttr('tabindex');},toggle:function(){if(this.$container.hasClass('combobox-selected')){this.clearTarget();this.triggerChange();this.clearElement();}else if(this.shown)this.hide();else{this.clearElement();this.lookup();}},clearElement:function(){this.$element.val('').focus();},clearTarget:function(){this.$source.val('');this.$target.val('');this.$container.removeClass('combobox-selected');this.selected=false;},triggerChange:function(){this.$source.trigger('change');},refresh:function(){this.source=this.parse();this.options.items=this.source.length;},select:function(){var a=this.$menu.find('.active').attr('data-value');this.$element.val(this.updater(a)).trigger('change');this.$source.val(this.map[a]).trigger('change');this.$target.val(this.map[a]).trigger('change');this.$container.addClass('combobox-selected');this.selected=true;return this.hide();},lookup:function(a){this.query=this.$element.val();return this.process(this.source);},listen:function(){this.$element.on('focus',a.proxy(this.focus,this)).on('blur',a.proxy(this.blur,this)).on('keypress',a.proxy(this.keypress,this)).on('keyup',a.proxy(this.keyup,this));if(this.eventSupported('keydown'))this.$element.on('keydown',a.proxy(this.keydown,this));this.$menu.on('click',a.proxy(this.click,this)).on('mouseenter','li',a.proxy(this.mouseenter,this)).on('mouseleave','li',a.proxy(this.mouseleave,this));this.$button.on('click',a.proxy(this.toggle,this));},keyup:function(a){switch(a.keyCode){case 40:case 39:case 38:case 37:case 36:case 35:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.clearTarget();this.lookup();}a.stopPropagation();a.preventDefault();},blur:function(a){var b=this;this.focused=false;var c=this.$element.val();if(!this.selected&&c!==''){this.$element.val('');this.$source.val('').trigger('change');this.$target.val('').trigger('change');}if(!this.mousedover&&this.shown)setTimeout(function(){b.hide();},200);},mouseleave:function(a){this.mousedover=false;}});a.fn.combobox=function(c){return this.each(function(){var d=a(this),e=d.data('combobox'),f=typeof c=='object'&&c;if(!e)d.data('combobox',(e=new b(this,f)));if(typeof c=='string')e[c]();});};a.fn.combobox.defaults={template:'<div class="combobox-container"><input type="hidden" /><input type="text" autocomplete="off" /><span class="add-on btn dropdown-toggle" data-dropdown="dropdown"><span class="caret"/><span class="combobox-clear"><i class="icon-remove"/></span></span></div>',menu:'<ul class="typeahead typeahead-long dropdown-menu"></ul>',item:'<li><a href="#"></a></li>'};a.fn.combobox.Constructor=b;}(window.jQuery);